# Example Project Configuration for Nexus with nexus-core Framework
#
# This file demonstrates how to configure multiple projects with the nexus bot,
# showing global defaults, per-project overrides, and how to customize workflows
# for different teams/projects.

# --- GLOBAL CONFIGURATION ---
# These settings apply to all projects unless overridden per-project

# Global workflow definition path (YAML workflow file - single source of truth)
# All workflow chains, routing logic, and agent orchestration are defined in this file
# See the workflow YAML for full step definitions, conditional routing, and approval gates
# Relative paths are resolved from BASE_DIR environment variable
workflow_definition_path: your-org/workflows/your_org_workflow.yaml

# VCS-agnostic inbox/tasks directory (can be .nexus, .gitlab, .gitea, etc.)
# Relative to project workspace root
# This allows the system to work with any VCS platform by changing a single config value
nexus_dir: .nexus

# Merge queue behavior (project-level enforcement)
# review_mode:
#   - manual: PR merge requires human approval
#   - auto: PR can be merged automatically by the queue worker when ready
merge_queue:
  review_mode: manual  # Overrideable per project

# Global AI tool preferences: which AI tool (and optionally model) to use
# for each AGENT TYPE.
# Options: copilot, gemini, codex
# Model override syntax: tool["model-name"] (e.g., copilot["gpt-4o-mini"])
# When no model is specified, the tool's default model is used.
#
# IMPORTANT: This maps AGENT TYPES (system roles) to AI tools, not individual agents
# - Agent types are defined in agent YAML files with `agent_type` field
# - Multiple agents can have the same type (e.g., two @triage agents for fallback)
# - Tasks are routed to agent types, not specific agents
# - The first available agent of that type handles the task
#
# Example agent YAML:
#   spec:
#     agent_type: "triage"       # This agent is a triage agent
#     provider_preference: null  # Can be overridden by ai_tool_preferences
ai_tool_preferences:
  # ===== SYSTEM AGENT TYPES (abstract roles used by workflows) =====
  # These types are used by:
  # - system_operations.inbox (routes issues to agent types)
  # - workflow YAML (assigns work to agent types)
  # - task assignment (looks for agents with matching system_type)
  
  triage: copilot["gpt-4o-mini"]          # Lightweight classification task
  designer: copilot                       # Architecture â€” needs full reasoning
  debug: copilot                          # Root cause analysis
  reviewer: copilot                       # PR reviews and code quality
  developer: copilot                      # Code implementation
  compliance: copilot["gpt-4o-mini"]      # Checklist-style security review
  deployer: copilot["gpt-4o-mini"]        # Mostly mechanical CLI steps
  docs: gemini["gemini-2.0-flash"]        # Documentation updates (fast + cheap)
  summarizer: gemini["gemini-2.0-flash"]  # Workflow summaries (fast + cheap)
  escalation: copilot                     # High-priority escalation

# Global operation task -> agent type mapping.
# These are non-agent orchestration tasks (classification, naming, refinement);
# provider is resolved via ai_tool_preferences for the selected agent type.
system_operations:
  launch: triage
  default: triage
  classify: triage
  route: triage
  detect_intent: triage
  generate_name: triage
  refine_description: triage
  transcribe_audio: triage
  chat:
    designer:
      context_path: your-org/docs
      context_files:
        - AGENTS.md
    triage: { }
    compliance: { }
    writer: { }

# --- PROJECT CONFIGURATIONS ---
# Each project must have: agents_dir, workspace
# Recommended: git_repo (primary). Optional: git_repos for multi-repo projects.
# Optional: workflow_definition_path, ai_tool_preferences
# Paths (agents_dir, workspace, workflow_definition_path) can be relative to BASE_DIR

# Example: Project A (uses global defaults)
project_a:
  agents_dir: project-a/agents
  workspace: project_a
  git_repo: acme/project-a

# Example: Project B (uses global defaults)
project_b:
  agents_dir: project-b/agents
  workspace: project_b
  git_repo: acme/project-b

# Example: Project C (uses global defaults)
project_c:
  agents_dir: project-c/agents
  workspace: project_c
  git_repo: acme/project-c

# Example: Custom Project (CUSTOM AI TOOLS - OVERRIDES global defaults)
# This shows how to customize AI tool preferences for specific agents
custom_project:
  agents_dir: custom-project/agents
  workspace: custom_project
  git_repo: acme/custom-project

  # Optional per-project overrides for operation task routing.
  system_operations:
    launch: triage
    default: triage
    refine_description: designer
    overrides:
      issue:
        refine_description: triage
    chat:
      designer:
        label: "Product Designer"
        context_path: custom-project/docs
        context_files:
          - PRODUCT.md
      triage:
        label: "Technical Lead"
  
  # Use a different workflow YAML file for this project  
  # (defaults to global workflow_definition_path if not specified)
  # Can be relative (to BASE_DIR) or absolute path
  workflow_definition_path: custom-project/workflows/custom_workflow.yaml
  
  # Custom AI tool preferences for this project's agents
  # Map agent_type (from workflow YAML) to AI tool (copilot/gemini/codex)
  # Only list agents that differ from global defaults
  ai_tool_preferences:
    triage: copilot          # Triage agent - issue classification
    designer: copilot        # Designer agent - technical proposals  
    debug: copilot           # Debug agent - root cause analysis
    reviewer: copilot        # Reviewer agent - PR reviews
    developer: copilot       # Developer agent - code implementation
    docs: gemini             # Docs agent - documentation updates (faster)
    summarizer: gemini       # Summarizer agent - workflow summaries (faster)
    OpsCommander: gemini     # Deployment agent (if using Ghabs org agents)
