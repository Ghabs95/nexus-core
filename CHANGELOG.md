# Changelog

All notable changes to this project will be documented in this file.

The format is based on [Keep a Changelog](https://keepachangelog.com/en/1.0.0/).

---

## [Unreleased]

### Added
- **Multi-Agent Collaborative Delegation Protocol** — Introduced a formal handoff and delegation protocol that allows agents to request sub-tasks from other specialized agents within a single workflow. This enables complex, non-linear workflows by allowing a "lead" agent to delegate work and await structured results via `DelegationRequest` and `DelegationCallback` models ([#70](https://github.com/Ghabs95/nexus-core/issues/70)).
- **HandoffManager for Delegation Tracking** — Added a thread-safe `HandoffManager` in `nexus.plugins.plugin_runtime` to register, track, and resolve active agent delegations.
- **AIOrchestrator Delegation Support** — `AIOrchestrator` now supports `execute_with_delegation()`, which automatically registers delegations and resolves them by scanning agent output for nested `__delegation_callback__` JSON markers.
- **Agent Handoff Protocol** — Defined a standardized communication schema (`HandoffPayload`) for agents to pass tasks, context, and verification tokens to one another. Includes a new module `nexus.core.chat_agents_schema` with HMAC-SHA256 state-signing for verified context transfer and `HandoffDispatcher` for retry and timeout logic during agent-to-agent delegations ([#70](https://github.com/Ghabs95/nexus-core/issues/70)).
- **Configurable Storage Adapters** — Introduced a unified configuration mechanism for storage backends (File and PostgreSQL) via `WorkflowStateEnginePlugin`. Users can now switch backends using the `storage_type` configuration key or the `NEXUS_STORAGE_TYPE` environment variable ([#65](https://github.com/Ghabs95/nexus-core/issues/65)).
- **PostgreSQL Environment Variable Support** — Added `NEXUS_STORAGE_DSN` for secure PostgreSQL connection management, avoiding plaintext credentials in configuration files.
- **YAML Workflow Orchestration** — Introduced `YamlWorkflowLoader` for loading and validating workflow definitions from YAML. This enables complex multi-step AI workflows with support for parallel execution, conditional branching, and retry policies ([#62](https://github.com/Ghabs95/nexus-core/issues/62)).
- **Schema Validation** — `YamlWorkflowLoader` performs comprehensive schema validation before instantiation, ensuring `agent_type`, `retry_policy`, and `parallel` groups are correctly defined.
- **Retry Policies in YAML** — Workflow steps can now define a `retry_policy` block in YAML, supporting `max_retries`, `backoff` strategy (exponential, linear, constant), and `initial_delay`.
- **Parallel Step Execution Foundation** — Added `parallel` field to YAML step definitions and `WorkflowStep.parallel_with` to the core model. Introduced `WorkflowEngine.get_runnable_steps()` to identify steps that can be executed concurrently.
- **Enhanced YAML Loading** — `YamlWorkflowLoader` exported via `nexus.core` for a cleaner public API. Support for `strict` mode to promote schema warnings to errors during loading.

### Changed
- `WorkflowDefinition.from_dict()` now parses `retry_policy.max_retries` from YAML into `WorkflowStep.retry`, while maintaining backward compatibility for explicit `retry` integer fields.
- `WorkflowStep` model updated with `parallel_with: List[str]` field to track concurrent execution dependencies.

### Security
- **Safe YAML Loading** — All YAML loading now exclusively uses `yaml.safe_load()` to prevent arbitrary code execution vulnerabilities from untrusted YAML content.

---

_Generated by @Writer — nexus-core issue [#62](https://github.com/Ghabs95/nexus-core/issues/62)_
